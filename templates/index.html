<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Laser Assistant</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #1e1e2f;
            color: #ddd;
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: #2d2d44;
            padding: 1rem;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .location-btn {
            display: block;
            width: 100%;
            margin: 0.25rem 0;
            padding: 0.5rem;
            background-color: #444466;
            border: none;
            border-radius: 5px;
            color: #ddd;
            cursor: pointer;
        }

        .location-btn:hover {
            background-color: #5a5a88;
        }

        .main {
            flex-grow: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .control-grid {
            display: grid;
            grid-template-areas:
        ". up ."
        "left . right"
        ". down .";
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .control-grid button {
            padding: 1rem;
            font-size: 1.2rem;
            background-color: #4d4d6b;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            width: 80px;
            height: 80px;
        }

        .control-grid button:hover {
            background-color: #66668a;
        }

        .form {
            margin-top: 1rem;
        }

        .form input, .form select {
            padding: 0.4rem;
            border-radius: 5px;
            border: none;
            margin-right: 0.5rem;
        }

        .form button {
            padding: 0.4rem 1rem;
            background-color: #3a3a55;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #position {
            font-size: 1.1rem;
            margin-top: 1rem;
            color: #9ecfff;
        }

        #voice-btn {
            margin-top: 2rem;
            padding: 0.6rem 1rem;
            font-size: 1rem;
            background-color: #3a3a55;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #voice-transcript {
            margin-top: 0.5rem;
            color: #aaa;
        }
    </style>
</head>
<body>
<div class="sidebar">
    <h2>Saved Locations</h2>
    {% for loc in locations %}
    <button class="location-btn" onclick="gotoLocation('{{ loc }}')">{{ loc }}</button>
    {% endfor %}
</div>

<div class="main">
    <div class="controls">
        <div class="control-grid">
            <button onclick="move('up')" style="grid-area: up;">‚Üë</button>
            <button onclick="move('left')" style="grid-area: left;">‚Üê</button>
            <button onclick="move('right')" style="grid-area: right;">‚Üí</button>
            <button onclick="move('down')" style="grid-area: down;">‚Üì</button>
        </div>

        <div class="form">
            <label for="step">Step Size:</label>
            <select id="step">
                <option value="1">1</option>
                <option value="5" selected>5</option>
                <option value="10">10</option>
                <option value="20">20</option>
            </select>
        </div>

        <div class="form">
            <input type="text" id="location-name" placeholder="New location name">
            <button onclick="saveLocation()">Save</button>
        </div>

        <div id="position">Position: X: ?, Y: ?</div>

        <button id="voice-btn">üéôÔ∏è Speak</button>
        <div id="voice-transcript"></div>
    </div>
</div>

<script>
    function move(direction) {
        const stepSize = document.getElementById('step').value;
        fetch('/move_manual', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ direction: direction, step_size: parseInt(stepSize) })
        });
    }

    function saveLocation() {
        const name = document.getElementById('location-name').value;
        if (!name) return alert("Name required");
        fetch('/save_location', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ name: name })
        }).then(() => location.reload());
    }

    function gotoLocation(name) {
        fetch(`/goto/${encodeURIComponent(name)}`, { method: 'POST' });
    }

    function updatePosition() {
        fetch('/get_position')
            .then(res => res.json())
            .then(pos => {
                document.getElementById('position').innerText = `Position: X: ${pos.x}, Y: ${pos.y}`;
            });
    }
    setInterval(updatePosition, 1000);

    // Voice recognition
    const voiceMap = {
        "screwdriver": "screwdrivers drawer",
        "tv": "TV",
        "fridge": "fridge",
        "tools": "tool cabinet"
    };

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    document.getElementById("voice-btn").addEventListener("click", () => {
        recognition.start();
    });

    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        document.getElementById("voice-transcript").innerText = `üó£Ô∏è "${transcript}"`;

        if (transcript.includes("where") || transcript.includes("point") || transcript.includes("show")) {
            for (const key in voiceMap) {
                if (transcript.includes(key)) {
                    const location = voiceMap[key];
                    fetch(`/goto/${encodeURIComponent(location)}`, { method: "POST" });
                    return;
                }
            }
        }

        alert("‚ùå Didn't recognize a known location.");
    };

    recognition.onerror = function(e) {
        alert("Speech error: " + e.error);
    };
</script>
</body>
</html>
